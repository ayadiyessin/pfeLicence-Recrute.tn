<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestionnaire | Mot de passe oublié</title>
  <link rel="icon" type="image/png" href="../dist/img/Recrutelogo.png">

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="../plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../dist/css/adminlte.min.css">
  <script>
    if(localStorage.getItem("ID_ADM")){
      location.replace("../index.html");
    }
  </script>
</head>
<body class="hold-transition login-page">
    <!-- Preloader -->
  <div class="preloader flex-column justify-content-center align-items-center">
    <img class="animation__shake" src="../dist/img/Recrute.fr.png" alt="AdminLTELogo" >
  </div>

<div class="login-box">
    <div class="card card-outline card-primary">
        <div class="card-header text-center">
            <h1><b>Recrute</b></h1>
        </div>

        <div class="card-body ">
            <p class="login-box-msg">Veuillez entrer votre adresse e-mail pour récupérer son mot de passe.</p>

            <form onsubmit="return false" id="form">
                <div class="input-group mb-3">
                    <input type="email" name="EMAIL" class="form-control" id="EMAIL_ADM" placeholder="Adresse e-mail">
                     <div class="input-group-append">
                        <div class="input-group-text">
                            <span class="fas fa-envelope"></span>
                        </div>
                     </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary btn-block">Envoyer le mot de passe par e-mail</button>
                    </div>
                    <!-- /.col -->
                </div>
        
            </form>

            <p class="mt-3 mb-1">
                <a href="login.html">Connexion</a>
            </p>
        </div>
            <!-- /.card-body -->
    </div>
</div>
<!-- /.login-box -->
<!--alert-->
<script src="https://unpKg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- jQuery -->
<script src="../plugins/jquery/jquery.min.js"></script>

<script src="../plugins/jquery-validation/jquery.validate.min.js"></script>
<script src="../plugins/jquery-validation/additional-methods.min.js"></script>
<script src="https://smtpjs.com/v3/smtp.js"></script>
<!-- Bootstrap 4 -->
<script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/adminlte.min.js"></script>
<script>
    $(function () {
  
        $.validator.setDefaults({
            submitHandler: function () {

                var request = new XMLHttpRequest()
                // Open a new connection, using the GET request on the URL endpoint
                var nb=0;
                request.open('GET', 'http://192.168.43.96:3000/admins', true)
                request.onload = function()
                {
                // Begin accessing JSON data here
                var data = JSON.parse(this.response);
                console.log(data);
                data.forEach(j => {
                    if(document.getElementById("EMAIL_ADM").value== j.EMAIL_ADM){
                        nb +=1;
                        Email.send({
                            Host: "smtp.gmail.com",
                            Username : "tunisierecrute0@gmail.com",
                            Password : "Recrute123",
                            To : `${j.EMAIL_ADM}`,
                            From : "tunisierecrute0@gmail.com",
                            Subject : "Ceci votre mot de passe",
                            Body : `${j.PSW_ADM}`,
			            }) 
                    }
                })
                if(nb==0){
                    //alert("E-mail est introuvable");
                    Swal.fire('E-mail est introuvable');
                   // location.replace("oblierPSW.html");
                }else{
                    //location.replace("login.html");
                   // event.preventDefault();
                    Swal.fire({
                      title:'E-mail envoyé avec succès.',
                      icon:'success',
                    
                  }).then((result) => {
                      if (result.isConfirmed){
                        location.replace("login.html");
                        //event.preventDefault();
                      }

                  })
                }
                }
                request.send();
            }
        });
        
        $('#form').validate({
        
            rules: {
            EMAIL: {
                required: true,
                email: true,
            },
            },
            messages: {
            EMAIL: {
                required: "Veuillez saisir une adresse e-mail",
                email: "S'il vous plaît, mettez une adresse email valide"
            }
            },
            errorElement: 'span',
            errorPlacement: function (error, element) {
            error.addClass('invalid-feedback');
            element.closest('.form-group').append(error);
            },
            highlight: function (element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
            },
            unhighlight: function (element, errorClass, validClass) {
            $(element).removeClass('is-invalid');
            $(element).addClass('is-valid');
            }
        
        });
        jQuery.validator.addMethod(
        "email",
        function(value, element) {
            return /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value);
        },)
    });

</script>
</body>
</html>
